











on_actions = {



	on_monthly_CHI = {
	
		effect = {
			set_temp_variable = {
				var=Final_chuanyu_people_support_to_china_government_modifier
				value=modifier@chuanyu_people_support_to_china_government_modifier
			}
			divide_temp_variable={
				Final_chuanyu_people_support_to_china_government_modifier=10
			}
			add_to_variable = { DSC_people_support = Final_chuanyu_people_support_to_china_government_modifier }
	
		
		if = {
					limit = {
					CHI = {
		OR = {			
		has_dynamic_modifier = {
			modifier = DSC_people_support_dynamic_left
		}
		has_dynamic_modifier = {
		modifier = DSC_people_support_dynamic_right
		}
		}
		}
		}
		
		CHI = {clamp_variable  = {
			var = DSC_people_support
			min = 0
		max = 1
		}
		DSC_people_support_dynamic_scriptes = yes
		
		}
		}
				if = {
					limit = {
					CHI = {
		has_dynamic_modifier = {
			modifier = DSC_people_support_dynamic_left
		}
		
					OR = {
CHI={
	OR={

		has_cosmetic_tag =DSC_GMQ
	has_cosmetic_tag =DSC_GMG
}
} 
						}
		}
		}
		DSC_people_support_dynamic_scriptes_left = yes
		}
		}
		
	}




	on_startup = {
		  effect = { # NEVER FORGET! Important to include this line to distinguish it from random_events = { ... }
				every_country = {
					limit = {
						is_ai = no
					}
	#country_event = welcome_event.1
				}
				CHI = {
	DSC_people_support_dynamic_scriptes = yes
	
				}
			}
	
	}
	on_daily_CHI = {
	effect = {




			if = {
				limit = {
				CHI = {
	has_dynamic_modifier = {
		modifier = DSC_people_support_dynamic
	}
	}
	}
	CHI = {clamp_variable  = {
		var = DSC_people_support
		min = 0
	max = 1
	}
	DSC_people_support_dynamic_scriptes = yes
	
	}
	}
			if = {
				limit = {
				CHI = {
	has_dynamic_modifier = {
		modifier = DSC_people_support_dynamic
	}
	
	CHI={
		OR={
	
			has_cosmetic_tag =DSC_GMQ
		has_cosmetic_tag =DSC_GMG
	}
	} 
	}
	}
	DSC_people_support_dynamic_scriptes_left = yes
	}

	}
}



on_daily_CHI = {
	effect = {
	if={
	limit={
	has_country_flag = neizhanzhong
	has_civil_war = no



	}
clr_country_flag = neizhanzhong
set_popularities = {
		democratic = 10.0
		communism = 70.0
		fascism = 0.0
		neutrality = 20.0
		nationalist = 0.0
	}
				set_country_flag = CHI_left


					start_politics_input = yes

					set_politics = {ruling_party = communism elections_allowed = no }
					add_to_array = { ruling_party = 5 } #CPC
					set_variable = { party_pop_array^5 = 0.55 }
					set_variable = { party_pop_array^4 = 0.15 }
					set_variable = { party_pop_array^19 = 0.2 }
					set_variable = { party_pop_array^2 = 0.10 }

					#generate the rest
add_to_array = { gov_coalition_array = 19 }
				startup_politics = yes

set_politics = {
	ruling_party = communism
	elections_allowed = no
}


}
	
	}
}



	on_weekly_CHI = {
		effect = {
			# 条件一：如果内战风险变量大于等于1
			if = {
				limit = {
					check_variable = {
						var = CHI_neizhanfengxian
						value = 0.97
						compare = greater_than_or_equals
					}
				}
				# 重置内战风险变量为极小值
				#set_variable = {
				#	var = CHI_neizhanfengxian
				#	value = -10000000
				#}
				# 触发内战相关事件
				country_event = { id = prc1.57 days = 3 }
			}

			# 条件二：如果国家有 "cjsl" 标志，就每周增加内战风险
			if = {
				limit = {
					AND={
							has_country_flag = jingjizhuangtai
		NOT = { has_country_flag = neizhanzhihou }
		has_country_flag = cjsl
					}



				}
				add_to_variable = {
					var = CHI_neizhanfengxian
					value = 0.025
				}
			}
		}
	}

	


on_monthly_CHI = {

	effect = {      
		if = {
			limit = {
				check_variable = { global.month > 11 }

			}
			CHI_Massive_layoffs_improve = yes
		}
		

		if = {
			limit = {
				check_variable = { global.year > 1999 }
				check_variable = { global.month > 4 }
				tag=CHI
				NOT={has_country_flag = CHI_xianzhizifayundong_completed}
			}



				news_event = { id = prc1.168 days = 14 }
			}


		set_temp_variable = {
			var=Final_Chinese_people_support_to_china_government_modifier
			value=modifier@Chinese_people_support_to_china_government_modifier
		}
		divide_temp_variable={
			Final_Chinese_people_support_to_china_government_modifier=10
		}
	
		
		add_to_variable = { CHI_people_support =Final_Chinese_people_support_to_china_government_modifier }

	
	if = {
				limit = {
				CHI = {		
	has_dynamic_modifier = {
		modifier = CHI_people_support_dynamic_left
	}

	}
	}
	
	CHI = {clamp_variable  = {
		var = CHI_people_support
		min = 0
	max = 1
	}
	CHI_people_support_dynamic_scriptes = yes
	
	}
	}
			if = {
				limit = {
				CHI = {
	has_dynamic_modifier = {
		modifier = CHI_people_support_dynamic_left
	}
	
				OR = {
					custom_trigger_tooltip = {
						is_in_array = { ruling_party = 4 }
						tooltip = has_communist_state_government_TT
					}
									custom_trigger_tooltip = {
						is_in_array = { ruling_party = 5 }
						tooltip = has_anarchist_communism_government_TT
					}
					custom_trigger_tooltip = {
						is_in_array = { ruling_party = 19 }
						tooltip = has_neutral_communism_government_TT
					}
					}
	}
	}
	CHI_people_support_dynamic_scriptes_left = yes
	}










every_owned_state = {
    limit = { is_core_of = ROOT } 
    
    if = {
        limit = { has_dynamic_modifier = {modifier =  CHI_hongweibing_yundong}
		NOT={				OR={
			has_dynamic_modifier = {modifier =  CHI_gemingweiyuanhui}
						has_dynamic_modifier = {modifier =  CHI_gemingweiyuanhui_baoshou}
			
			has_dynamic_modifier = {modifier =  CHI_gongshe}
			}}
		} 
		random_list = {
			50 = {
				remove_dynamic_modifier = { modifier = CHI_hongweibing_yundong }
				add_dynamic_modifier = {modifier = CHI_hongweibing_yundong2}
			}
			50 = {
				# 什么都不做，占位避免脚本崩溃
			}
		}
    }

    else_if = {
        limit = { has_dynamic_modifier = {modifier =  CHI_hongweibing_yundong2}
		NOT={				OR={
			has_dynamic_modifier = {modifier =  CHI_gemingweiyuanhui}
									has_dynamic_modifier = {modifier =  CHI_gemingweiyuanhui_baoshou}
			has_dynamic_modifier = {modifier =  CHI_gongshe}
			}}
		} 
		random_list = {
			50 = {
				remove_dynamic_modifier = { modifier = CHI_hongweibing_yundong2 }
				add_dynamic_modifier = {modifier = CHI_hongweibing_yundong3}
			}
			50 = {
				# 保留空行为
			}
		}
    }

    else_if = {
        limit = { has_dynamic_modifier = {modifier =  CHI_hongweibing_yundong3} 
		NOT={		
			OR={
				has_dynamic_modifier = {modifier =  CHI_gemingweiyuanhui}
										has_dynamic_modifier = {modifier =  CHI_gemingweiyuanhui_baoshou}
				has_dynamic_modifier = {modifier =  CHI_gongshe}
			}
		}
		} 
		remove_dynamic_modifier = { modifier = CHI_hongweibing_yundong3 }
		add_dynamic_modifier = {modifier = CHI_hongweibing_yundong4}
    }

    else_if = {
        limit = { has_dynamic_modifier = {modifier =  CHI_hongweibing_yundong4} 
		NOT={ OR={
			has_dynamic_modifier = {modifier =  CHI_gemingweiyuanhui}
									has_dynamic_modifier = {modifier =  CHI_gemingweiyuanhui_baoshou}
			has_dynamic_modifier = {modifier =  CHI_gongshe}
			}}
		} 
		remove_dynamic_modifier = { modifier = CHI_hongweibing_yundong4 }
		add_dynamic_modifier = {modifier = CHI_hongweibing_yundong5}
    }

    if = {
        limit = { 
			has_dynamic_modifier = {modifier =  CHI_hongweibing_yundong4} 
			CHI={
				has_country_flag = allow_gmwyh 
			}
			NOT={
				OR={
											has_dynamic_modifier = {modifier =  CHI_gemingweiyuanhui_baoshou}
				
				has_dynamic_modifier = {modifier =  CHI_gemingweiyuanhui}
								has_dynamic_modifier = {modifier = CHI_wudouhunluan}
				

			}
			}
		} 

random_list = {
	60={
		add_dynamic_modifier = {modifier = CHI_gemingweiyuanhui}
	}
	30={
				add_dynamic_modifier = {modifier = CHI_gemingweiyuanhui_baoshou}
	}
10={
					add_dynamic_modifier = {modifier = CHI_wudouhunluan}
}
}


    }

    if = {
        limit = { 
			has_dynamic_modifier = {modifier =  CHI_hongweibing_yundong4} 
			CHI={
				has_country_flag = allow_gongshe
			}
			NOT={
				has_dynamic_modifier = {modifier =  CHI_gongshe}
			}
		} 
		add_dynamic_modifier = {modifier = CHI_gongshe}  # ✅ 修正逻辑错误：之前错误地添加了革命委员会
    }

	if = {
        limit = { 
			has_dynamic_modifier = {modifier =  CHI_hongweibing_yundong5} 
			OR={
				has_dynamic_modifier = {modifier =  CHI_gemingweiyuanhui}
								has_dynamic_modifier = {modifier =  CHI_gemingweiyuanhui_baoshou}
				has_dynamic_modifier = {modifier =  CHI_gongshe}
			}
		} 
		remove_dynamic_modifier = { modifier = CHI_hongweibing_yundong5 }
		add_dynamic_modifier = {modifier = CHI_hongweibing_yundong4}
    }

    else_if = {
        limit = { 
			has_dynamic_modifier = {modifier =  CHI_hongweibing_yundong4} 
			OR={
				has_dynamic_modifier = {modifier =  CHI_gemingweiyuanhui}
								has_dynamic_modifier = {modifier =  CHI_gemingweiyuanhui_baoshou}
				has_dynamic_modifier = {modifier =  CHI_gongshe}
			}
		} 
		remove_dynamic_modifier = { modifier = CHI_hongweibing_yundong4 }
		add_dynamic_modifier = {modifier = CHI_hongweibing_yundong3}
    }

    else_if = {
        limit = { 
			has_dynamic_modifier = {modifier =  CHI_hongweibing_yundong3} 
			OR={
				has_dynamic_modifier = {modifier =  CHI_gemingweiyuanhui}
				has_dynamic_modifier = {modifier =  CHI_gemingweiyuanhui_baoshou}
				has_dynamic_modifier = {modifier =  CHI_gongshe}
			}
		} 
		remove_dynamic_modifier = { modifier = CHI_hongweibing_yundong3 }
		add_dynamic_modifier = {modifier = CHI_hongweibing_yundong2}
    }
}












	}
	
}
on_startup = {
      effect = { # NEVER FORGET! Important to include this line to distinguish it from random_events = { ... }
            every_country = {
                limit = {
                    is_ai = no
                }
#country_event = welcome_event.1
            }
            CHI = {
CHI_people_support_dynamic_scriptes = yes

            }
        }

}
on_daily_CHI = {
effect = {
		if = {
			limit = {
			CHI = {
has_dynamic_modifier = {
    modifier = CHI_people_support_dynamic
}
}
}
CHI = {
	clamp_variable  = {
   		var = CHI_people_support
    	min = 0
		max = 1
}
CHI_people_support_dynamic_scriptes = yes

}
}
		if = {
			limit = {
			CHI = {
has_dynamic_modifier = {
    modifier = CHI_people_support_dynamic
}

			OR = {
				custom_trigger_tooltip = {
					is_in_array = { ruling_party = 4 }
					tooltip = has_communist_state_government_TT
				}
								custom_trigger_tooltip = {
					is_in_array = { ruling_party = 5 }
					tooltip = has_anarchist_communism_government_TT
				}
				custom_trigger_tooltip = {
					is_in_array = { ruling_party = 19 }
					tooltip = has_neutral_communism_government_TT
				}
				}
}
}
CHI_people_support_dynamic_scriptes_left = yes
}

}
}
}